apiVersion: v1
data:
  prometheus.yaml: "global:\n  scrape_interval: 10s\n  scrape_timeout: 10s\n  evaluation_interval:
    10s\nscrape_configs:\n\n  # https://github.com/prometheus/prometheus/blob/master/documentation/examples/prometheus-kubernetes.yml#L37\n
    \ - job_name: 'kubernetes-nodes'\n    tls_config:\n      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n
    \   bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n    kubernetes_sd_configs:\n
    \     - role: node\n    relabel_configs:\n      - source_labels: [__address__]\n
    \       regex: '(.*):10250'\n        replacement: '${1}:10255'\n        target_label:
    __address__\n\n  # https://github.com/prometheus/prometheus/blob/master/documentation/examples/prometheus-kubernetes.yml#L79\n
    \ - job_name: 'kubernetes-endpoints'\n    kubernetes_sd_configs:\n      - role:
    endpoints\n    relabel_configs:\n      - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scrape]\n
    \       action: keep\n        regex: true\n      - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_scheme]\n
    \       action: replace\n        target_label: __scheme__\n        regex: (https?)\n
    \     - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_path]\n
    \       action: replace\n        target_label: __metrics_path__\n        regex:
    (.+)\n      - source_labels: [__address__, __meta_kubernetes_service_annotation_prometheus_io_port]\n
    \       action: replace\n        target_label: __address__\n        regex: (.+)(?::\\d+);(\\d+)\n
    \       replacement: $1:$2\n      - action: labelmap\n        regex: __meta_kubernetes_service_label_(.+)\n
    \     - source_labels: [__meta_kubernetes_namespace]\n        action: replace\n
    \       target_label: kubernetes_namespace\n      - source_labels: [__meta_kubernetes_service_name]\n
    \       action: replace\n        target_label: kubernetes_name\n\n  # https://github.com/prometheus/prometheus/blob/master/documentation/examples/prometheus-kubernetes.yml#L119\n
    \ - job_name: 'kubernetes-services'\n    metrics_path: /probe\n    params:\n      module:
    [http_2xx]\n    kubernetes_sd_configs:\n      - role: service\n    relabel_configs:\n
    \     - source_labels: [__meta_kubernetes_service_annotation_prometheus_io_probe]\n
    \       action: keep\n        regex: true\n      - source_labels: [__address__]\n
    \       target_label: __param_target\n      - target_label: __address__\n        replacement:
    blackbox\n      - source_labels: [__param_target]\n        target_label: instance\n
    \     - action: labelmap\n        regex: __meta_kubernetes_service_label_(.+)\n
    \     - source_labels: [__meta_kubernetes_namespace]\n        target_label: kubernetes_namespace\n
    \     - source_labels: [__meta_kubernetes_service_name]\n        target_label:
    kubernetes_name\n\n  # https://github.com/prometheus/prometheus/blob/master/documentation/examples/prometheus-kubernetes.yml#L156\n
    \ - job_name: 'kubernetes-pods'\n    kubernetes_sd_configs:\n      - role: pod\n
    \   relabel_configs:\n      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]\n
    \       action: keep\n        regex: true\n      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]\n
    \       action: replace\n        target_label: __metrics_path__\n        regex:
    (.+)\n      - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]\n
    \       action: replace\n        regex: (.+):(?:\\d+);(\\d+)\n        replacement:
    ${1}:${2}\n        target_label: __address__\n      - action: labelmap\n        regex:
    __meta_kubernetes_pod_label_(.+)\n      - source_labels: [__meta_kubernetes_namespace]\n
    \       action: replace\n        target_label: kubernetes_namespace\n      - source_labels:
    [__meta_kubernetes_pod_name]\n        action: replace\n        target_label: kubernetes_pod_name\n
    \     - source_labels: [__meta_kubernetes_pod_container_port_number]\n        action:
    keep\n        regex: 9\\d{3}\n\n  - job_name: 'kubernetes-cadvisor'\n    scheme:
    https\n    tls_config:\n      ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n
    \   bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n    kubernetes_sd_configs:\n
    \     - role: node\n    relabel_configs:\n      - action: labelmap\n        regex:
    __meta_kubernetes_node_label_(.+)\n      - target_label: __address__\n        replacement:
    kubernetes.default.svc:443\n      - source_labels: [__meta_kubernetes_node_name]\n
    \       regex: (.+)\n        target_label: __metrics_path__\n        replacement:
    /api/v1/nodes/${1}/proxy/metrics/cadvisor\n        "
kind: ConfigMap
metadata:
  creationTimestamp: "2020-09-21T18:37:18Z"
  managedFields:
  - apiVersion: v1
    fieldsType: FieldsV1
    fieldsV1:
      f:data:
        .: {}
        f:prometheus.yaml: {}
    manager: kubectl-create
    operation: Update
    time: "2020-09-21T18:37:18Z"
  name: prometheus-core
  namespace: monitoring
  resourceVersion: "15112"
  selfLink: /api/v1/namespaces/monitoring/configmaps/prometheus-core
  uid: 4673249d-58db-44de-a053-5a1267488f4b
  namespace: monitoring
